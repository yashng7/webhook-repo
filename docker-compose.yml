version: "3.8"

services:
  mongo:
    image: mongo:7
    container_name: webhook-mongo
    volumes:
      - mongo-data:/data/db
    networks:
      - webhook-network
    restart: unless-stopped

  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    container_name: webhook-api
    ports:
      - "5000:5000"
    environment:
      - MONGO_URI=mongodb://mongo:27017/webhook_db
      - WEBHOOK_SECRET=your_webhook_secret_here
    depends_on:
      - mongo
    networks:
      - webhook-network
    restart: unless-stopped

  ui:
    build:
      context: ./ui
      dockerfile: Dockerfile
    container_name: webhook-ui
    ports:
      - "8080:80"
    depends_on:
      - api
    networks:
      - webhook-network
    restart: unless-stopped

  # ngrok:
  #   image: ngrok/ngrok:latest
  #   container_name: webhook-ngrok
  #   command: start --all --config /etc/ngrok.yml
  #   volumes:
  #     - ./ngrok.yml:/etc/ngrok.yml:ro
  #   ports:
  #     - "4040:4040"
  #   depends_on:
  #     - api
  #   networks:
  #     - webhook-network
  #   restart: unless-stopped

volumes:
  mongo-data:

networks:
  webhook-network:
    driver: bridge